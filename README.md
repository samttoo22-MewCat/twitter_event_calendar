# X (Twitter) 活動日曆爬蟲系統

這是一個基於 Python 的 X (Twitter) 活動爬蟲系統，用於自動抓取特定用戶的推文，並從中提取活動資訊，生成結構化的活動日曆資料。

## 主要功能

- 🤖 **自動爬蟲**：定時自動抓取多個 X (Twitter) 帳號的推文
- 📅 **智能日期解析**：自動識別推文中的日期、時間資訊（支持全形/半形字符）
- 🎨 **圖形化介面**：提供友善的 Tkinter GUI 介面
- 📝 **手動編輯**：支援手動校正和編輯活動資訊
- 🌐 **網站同步**：一鍵將活動資料同步到網站日曆
- 💾 **資料持久化**：自動保存並管理活動資料（JSON 格式）
- 🔐 **會話管理**：登入一次後自動保存會話，無需重複登入

## 技術架構

### 核心技術
- **爬蟲引擎**：SeleniumBase（UC 模式，規避反爬蟲機制）
- **GUI 框架**：Tkinter
- **日期解析**：datefinder + 自定義正則表達式
- **時區處理**：pytz（台灣時間 UTC+8）

### 項目結構

```
twitter_event_calendar/
├── UI_main.py                    # 主程式（GUI 介面）
├── crawler_API.py                # 舊版爬蟲 API（已棄用）
├── requirement.txt               # Python 依賴套件
├── .gitignore                    # Git 忽略規則
├── README.md                     # 本文件
├── index.html                    # 活動日曆網頁
│
├── UCanScrapeX/                  # 爬蟲模組
│   ├── __init__.py              # 模組初始化
│   ├── seleniumbase_crawler.py  # 爬蟲核心類
│   ├── example.py               # 使用範例
│   ├── requirements.txt         # 模組依賴
│   ├── README.md                # 英文說明
│   └── zh_TW_README.md          # 中文說明
│
├── outputs/                      # 活動資料輸出目錄
│   ├── 拘久屋_events.json
│   ├── 玩具間_events.json
│   ├── 更衣間_events.json
│   ├── 思_events.json
│   └── 動物方程式_events.json
│
└── profile1/                     # 瀏覽器配置文件（會話資料）
```

## 安裝說明

### 系統需求
- Python 3.8 或更高版本
- Chrome 瀏覽器

### 安裝步驟

1. **克隆專案**
```bash
git clone <repository-url>
cd twitter_event_calendar
```

2. **安裝依賴**
```bash
pip install -r requirement.txt
```

依賴套件包括：
- `seleniumbase` - 爬蟲框架
- `datefinder` - 日期解析
- `pytz` - 時區處理

## 使用方法

### 啟動程式

```bash
python UI_main.py
```

### 首次使用

1. **登入 X (Twitter)**
   - 點擊「手動登入 X」按鈕
   - 在彈出的瀏覽器視窗中完成登入
   - 登入完成後按 Enter 鍵繼續
   - 會話資料會保存在 `profile1/` 目錄，下次啟動無需重新登入

2. **設定爬蟲參數**
   - **爬蟲間隔**：設定自動執行的時間間隔（小時）
   - **抓取數量**：每次抓取的推文數量

3. **執行爬蟲**
   - **手動執行一次**：立即執行一次爬蟲
   - **啟動爬蟲**：按設定的間隔定時自動執行
   - **停止爬蟲**：停止定時執行

### 管理活動資料

#### 查看活動
- 在介面上方的分頁中選擇場地
- 雙擊日期項目查看該日期的活動詳情

#### 編輯活動
在活動詳情視窗中可以編輯：
- **活動日期**：格式為 `YYYY-MM-DD` 或 `N/A`
- **活動名稱**：活動標題
- **簡短描述**：活動簡介
- **開始時間**：格式為 `HH:MM`
- **結束時間**：格式為 `HH:MM`
- **連結**：相關網址

編輯完成後點擊「保存校正」按鈕。

#### 刪除活動
- 點擊「刪除活動」按鈕標記為刪除（不會永久移除）
- 已刪除的活動不會顯示在主列表中
- 可以點擊「取消刪除」恢復活動

### 同步到網站

點擊「同步網站」按鈕，系統會：
1. 讀取所有已校正的活動
2. 按年月分組
3. 更新 `index.html` 中的活動資料

## 支援的日期時間格式

### 日期格式
- `9/13`、`09/13` - 月/日（自動補年份）
- `9-13`、`09-13` - 月-日
- `9／13`、`09／13` - 全形斜線
- `9－13` - 全形減號
- 完整日期格式（由 datefinder 處理）

### 時間格式
- `19:00~22:00`、`19:00-22:00` - 標準格式
- `19：00～22：00` - 全形字符
- `19點-22點`、`19點～22點` - 中文格式
- `7pm-10pm` - 12小時制
- `晚上七點-十點` - 中文口語化

## 最近更新與 Bug 修復

### v2.0 - 整合 UCanScrapeX 模組（2024-10）

#### 主要更新
- ✅ 將爬蟲引擎從 Twikit 改為 UCanScrapeX (SeleniumBase)
- ✅ 使用物件導向的 XCrawler 類
- ✅ 改進瀏覽器資源管理，避免重複關閉錯誤
- ✅ 移除 asyncio 依賴，簡化程式架構

#### Bug 修復
- ✅ **修復全形字符日期解析**：支援 `10／10` 格式的日期
- ✅ **修復全形冒號時間解析**：支援 `19：00` 格式的時間
- ✅ **修復瀏覽器關閉錯誤**：避免 `'NoneType' object is not callable` 錯誤
- ✅ **改進日期驗證**：在創建 datetime 前先驗證月份和日期的有效性
- ✅ **更好的錯誤處理**：所有 except 區塊都包含錯誤輸出和 traceback

## 目標用戶

目前配置的抓取目標：
- **拘久屋** (@jukuya456)
- **玩具間** (@studiobondage)
- **更衣間** (@gengyiroom)
- **思** (@s9808191779632)
- **動物方程式** (@16fnzoo)

可在 `UI_main.py` 的 `_fetch_and_process_events()` 函數中修改 `user_configs` 來更改目標用戶。

## 資料格式

### JSON 事件格式

```json
{
    "date": "2025-10-10",
    "text": "原始推文內容",
    "title": "活動標題",
    "brief_description": "活動描述",
    "start_time": "19:00",
    "end_time": "22:00",
    "link": "https://example.com",
    "venue": "場地名稱",
    "check": false,
    "delete": false
}
```

### 欄位說明
- `date`: 活動日期（YYYY-MM-DD 格式）
- `text`: 原始推文文字
- `title`: 活動名稱
- `brief_description`: 活動簡介
- `start_time`: 開始時間
- `end_time`: 結束時間
- `link`: 相關連結
- `venue`: 場地名稱
- `check`: 是否已校正（true/false）
- `delete`: 是否已刪除（true/false）

## 注意事項

⚠️ **重要提醒**

1. **時區設定**：系統使用台灣時間（UTC+8）處理所有時間
2. **會話保持**：首次登入後，會話資料保存在 `profile1/` 目錄，請勿刪除
3. **資料備份**：建議定期備份 `outputs/` 目錄中的 JSON 文件
4. **反爬蟲限制**：使用 UC 模式的 SeleniumBase 來規避 X 的反爬蟲機制
5. **推文數量限制**：某些帳號可能因為推文較少而無法達到設定的抓取數量

## 常見問題

### Q: 為什麼顯示「沒有抓到足夠的推文」？
A: 這可能是因為：
- 該用戶的推文數量本身就較少
- 已經抓取過最新的推文（避免重複）
- 網路連線問題

### Q: 日期解析錯誤怎麼辦？
A: 系統會自動跳過無法解析的推文，您可以：
- 手動在 GUI 中編輯該活動的日期
- 檢查推文內容是否包含有效的日期格式

### Q: 如何添加新的場地？
A: 編輯 `UI_main.py` 中的 `user_configs` 列表，添加新的場地資訊。

## 開發者資訊

### 除錯模式
在 `_fetch_and_process_events()` 中設定 `debug=True` 可以查看：
- 原始推文文字
- 清理後的文字
- 爬蟲過程的詳細日誌

### 擴展功能
可以參考 `UCanScrapeX/example.py` 了解如何：
- 使用 XCrawler 類
- 自定義爬蟲參數
- 處理爬取結果

## 授權

本專案僅供學習和個人使用。使用時請遵守 X (Twitter) 的服務條款。

## 貢獻

歡迎提交 Issue 和 Pull Request！

---

**最後更新：2024-10**
